<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Search</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px 80px 20px;
        }
        
        .search-container {
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
        
        .search-input {
            width: 100%;
            padding: 16px 24px;
            font-size: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 24px;
            outline: none;
            transition: all 0.2s ease;
            color: #333;
            background: white;
            margin-bottom: 30px;
        }
        
        .search-input:focus {
            border-color: #4285f4;
            box-shadow: 0 1px 6px rgba(66, 133, 244, 0.2);
        }
        
        .search-input::placeholder {
            color: #9e9e9e;
        }
        
        .status {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            min-height: 20px;
        }
        
        .home-link {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: #666;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 20px;
        }
        
        .home-link:hover {
            color: #4285f4;
            background: #f8f9fa;
        }
        
        .pinwheel-icon {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }
        
        .home-link:hover .pinwheel-icon {
            transform: rotate(180deg);
        }
    </style>
    
    <!-- Pagefind CSS -->
    <link href="pagefind/pagefind-ui.css" rel="stylesheet">
</head>
<body>
    <div class="search-container">
        <h1 style="margin-bottom: 20px; color: #333; font-weight: 300;">Search Wiki</h1>
        <input type="text" class="search-input" placeholder="Search knowledge base..." id="search-input" autofocus>
        <div id="status" class="status">Loading search...</div>
        <div id="search"></div>
    </div>

    <a href="/" class="home-link">
        <img src="../img/pinwheel-star.svg" alt="Main Site" class="pinwheel-icon">
        Main Site
    </a>

    <!-- Pagefind JS -->
    <script src="pagefind/pagefind-ui.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusElement = document.getElementById('status');
            const searchInput = document.getElementById('search-input');
            
            // Focus search input
            searchInput.focus();
            
            // Initialize Pagefind
            initializePagefind();
            
            function initializePagefind() {
                if (typeof PagefindUI !== 'undefined') {
                    try {
                        new PagefindUI({ 
                            element: "#search",
                            showImages: false,
                            showEmptyFilters: false,
                            autofocus: false, // We're handling focus manually
                            processResult: (result) => {
                                // You can filter results here if needed
                                return result;
                            }
                        });
                        
                        statusElement.innerHTML = 'üîç Search ready - start typing';
                        console.log('Pagefind initialized successfully');
                        
                    } catch (error) {
                        console.error('Pagefind error:', error);
                        statusElement.innerHTML = '‚ö†Ô∏è Search error - using manual fallback';
                        initializeManualSearch();
                    }
                } else {
                    statusElement.innerHTML = '‚ö†Ô∏è Pagefind not loaded - using manual search';
                    initializeManualSearch();
                }
            }
            
            function initializeManualSearch() {
                // Simple manual search fallback
                const manualPages = [
                    { 
                        title: "Tom Hanks", 
                        url: "tom-hanks.html", 
                        excerpt: "Academy Award winning actor and filmmaker" 
                    },
                    { 
                        title: "Physics Concepts", 
                        url: "physics.html", 
                        excerpt: "Fundamental concepts in physics" 
                    }
                    // Add more pages here
                ];
                
                const searchContainer = document.getElementById('search');
                
                searchInput.addEventListener('input', function(e) {
                    const query = e.target.value.toLowerCase().trim();
                    
                    if (query.length < 2) {
                        searchContainer.innerHTML = '';
                        statusElement.innerHTML = 'Type to search...';
                        return;
                    }
                    
                    const results = manualPages.filter(page => 
                        page.title.toLowerCase().includes(query) ||
                        page.excerpt.toLowerCase().includes(query)
                    );
                    
                    statusElement.innerHTML = `Found ${results.length} result${results.length !== 1 ? 's' : ''}`;
                    
                    if (results.length === 0) {
                        searchContainer.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">No results found</div>';
                        return;
                    }
                    
                    let html = '';
                    results.forEach(page => {
                        html += `
                            <div style="padding: 20px; border: 1px solid #f0f0f0; border-radius: 8px; margin-bottom: 15px;">
                                <a href="${page.url}" style="color: #1a0dab; text-decoration: none; font-weight: 500; font-size: 18px; display: block; margin-bottom: 8px;">
                                    ${page.title}
                                </a>
                                <div style="color: #4d5156; font-size: 14px; line-height: 1.4;">${page.excerpt}</div>
                            </div>
                        `;
                    });
                    
                    searchContainer.innerHTML = html;
                });
                
                statusElement.innerHTML = 'Using manual search';
            }
        });
    </script>
</body>
</html>
